<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TechStore Pro — Carrito</title>
  <link rel="stylesheet" href="../output.css" />
</head>
<body class="bg-gray-50 dark:bg-gray-950 text-gray-900 dark:text-gray-100 font-sans transition-colors duration-300">

  <!-- HEADER -->
  <header class="bg-white dark:bg-gray-900 shadow-lg sticky top-0 z-50 transition-colors duration-500">
    <nav class="relative max-w-7xl mx-auto px-4 py-4">
      <div class="flex items-center justify-between relative">

        <div class="flex items-center flex-shrink-0">
          <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-3 py-2 rounded-lg mr-3">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" aria-hidden="true">
              <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
            </svg>
         </div>
          <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
            <a href="../pages/index.html">TechStore Pro</a>
          </h1>
        </div>
        <div class="hidden md:flex absolute left-1/2 transform -translate-x-1/2 space-x-6">
          <a href="./index.html" class="text-gray-700 dark:text-gray-200 hover:text-blue-600 font-medium transition-colors duration-200 relative group">
            Inicio <span class="absolute -bottom-1 left-0 w-full h-0.5 bg-blue-600"></span>
          </a>
          <a href="./productos.html" class="text-gray-700 dark:text-gray-200 hover:text-blue-600 font-medium transition-colors duration-200 relative group">
            Productos <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-blue-600 transition-all duration-200 group-hover:w-full"></span>
          </a>
          <a href="./contactenos.html" class="text-gray-700 dark:text-gray-200 hover:text-blue-600 font-medium transition-colors duration-200 relative group">
            Contacto <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-blue-600 transition-all duration-200 group-hover:w-full"></span>
          </a>
        </div>
        <div class="flex items-center space-x-3 absolute right-1 top-15">
          <!-- BOTÓN TEMA -->
          <button id="theme-toggle" class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition" aria-label="Alternar tema">
            <!-- SOL (light icon) -->
            <svg id="theme-toggle-light-icon" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
              <circle cx="12" cy="12" r="5"/>
              <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
            </svg>
            <!-- LUNA (dark icon) -->
            <svg id="theme-toggle-dark-icon" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 hidden" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>
            </svg>
          </button>
          <!-- CARRITO -->
          <a href="./car.html" class="relative group p-2 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 dark:hover:from-gray-800 dark:hover:to-gray-700 rounded-lg transition-all duration-300 transform hover:scale-105" aria-label="Carrito">
            <svg class="w-6 h-6 text-gray-700 dark:text-gray-200 transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-1.1 5m1.1-5l10 0m-10 0v5m10-5v5m0 0a2 2 0 11-4 0m-6 0a2 2 0 114 0"/>
            </svg>
            <span id="cart-counter" class="absolute -top-2 -right-2 bg-gradient-to-r from-red-500 via-pink-500 to-red-600 text-white text-xs font-bold rounded-full min-w-5 h-5 flex items-center justify-center px-1 shadow-lg border-2 border-white" style="display:none;">0</span>
          </a>
        </div>
      </div>
    </nav>
  </header>

  <!-- MAIN -->
  <main class="max-w-7xl mx-auto px-4 py-10">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
      <section class="lg:col-span-8">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 hover:shadow-2xl transition duration-300">
          <h2 class="text-2xl font-bold mb-4">Tu Carrito</h2>
          <p id="cart-empty-text" class="text-gray-600 dark:text-gray-300 mb-6 hidden">Tu carrito está vacío. <a href="./productos.html" class="text-blue-600 underline">Ver productos</a></p>

          <div id="cart-items" class="space-y-4">
            <!-- items del carrito se inyectan aquí -->
          </div>

          <div class="mt-6 flex justify-between items-center">
            <div class="flex items-center gap-3">
              <button id="continue-shopping" class="bg-white text-blue-600 px-6 py-3 rounded-lg text-md font-semibold hover:bg-gray-100 transition duration-200">Seguir comprando</button>
              <button id="empty-cart" class="border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 transition">Vaciar carrito</button>
            </div>

            <div id="cart-summary" class="text-right">
              <div class="text-sm text-gray-600 dark:text-gray-300">Artículos: <span id="cart-total-items">0</span></div>
              <div class="text-xl font-bold text-blue-600 dark:text-blue-400">Total: <span id="cart-total-price">$0</span></div>
              <button id="checkout-btn" class="mt-3 w-full md:w-auto bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:from-blue-700 hover:to-purple-700 transition">Proceder al pago</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Aside right: recomendaciones / resumen (4/12) -->
      <aside class="lg:col-span-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 mb-6 hover:shadow-2xl transition duration-300">
          <h3 class="text-xl font-bold mb-4">Resumen rápido</h3>
          <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">Los productos añadidos se guardan en tu navegador y se sincronizan entre pestañas.</p>
          <ul class="space-y-3 text-gray-700 dark:text-gray-200">
            <li class="flex justify-between"><span>Subtotal</span><span id="summary-subtotal">$0</span></li>
            <li class="flex justify-between"><span>Envío</span><span id="summary-shipping">Gratis</span></li>
            <li class="flex justify-between font-semibold"><span>Total</span><span id="summary-total">$0</span></li>
          </ul>
        </div>

        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6 hover:shadow-2xl transition duration-300">
          <h3 class="text-xl font-bold mb-4">¿Necesitas ayuda?</h3>
          <p class="text-sm text-gray-600 dark:text-gray-300">Contáctanos por WhatsApp o revisa nuestra política de devoluciones.</p>
          <div class="mt-4 flex gap-2">
            <a href="#" class="flex-1 text-center px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-700">WhatsApp</a>
            <a href="#" class="flex-1 text-center px-3 py-2 rounded-lg border border-gray-200 dark:border-gray-700">Soporte</a>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="bg-gray-900 dark:bg-gray-950 text-white py-12 transition-colors duration-500">
    <div class="max-w-7xl mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
        <div>
          <div class="flex items-center mb-4">
            <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-2 rounded-lg mr-3">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/></svg>
            </div>
            <h3 class="text-xl font-bold">TechStore Pro</h3>
          </div>
          <p class="text-gray-400 mb-4">Tu tienda de tecnología de confianza con los mejores productos y precios.</p>
        </div>

        <div>
          <h3 class="text-lg font-semibold mb-4">Enlaces</h3>
          <ul class="space-y-2 text-gray-400">
            <li><a href="./index.html" class="hover:text-white">Inicio</a></li>
            <li><a href="./productos.html" class="hover:text-white">Productos</a></li>
            <li><a href="./car.html" class="hover:text-white">Carrito</a></li>
          </ul>
        </div>

        <div>
          <h3 class="text-lg font-semibold mb-4">Atención</h3>
          <ul class="space-y-2 text-gray-400">
            <li><a href="./contactenos.html" class="hover:text-white">Contacto</a></li>
            <li><a href="#" class="hover:text-white">Envíos</a></li>
            <li><a href="#" class="hover:text-white">Devoluciones</a></li>
          </ul>
        </div>

        <div>
          <h3 class="text-lg font-semibold mb-4">Legal</h3>
          <ul class="space-y-2 text-gray-400">
            <li><a href="#" class="hover:text-white">Términos</a></li>
            <li><a href="#" class="hover:text-white">Privacidad</a></li>
            <li><a href="#" class="hover:text-white">Cookies</a></li>
          </ul>
        </div>
      </div>

      <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400">
        <p>&copy; 2025 TechStore Pro. Todos los derechos reservados.</p>
      </div>
    </div>
  </footer>

  <!-- Toast container (notificaciones) -->
  <div id="toast-container" class="fixed top-4 right-4 space-y-3 z-[9999]" aria-live="polite"></div>

  <!-- Script: conectado a main.js (tu script) + código carrito específico -->
  <script>
    // ---------- Car logic en la página (car.html) ----------
    // Key en localStorage
    const CART_KEY = 'techstore_cart';

    function readCart() {
      try {
        const raw = localStorage.getItem(CART_KEY);
        return raw ? JSON.parse(raw) : [];
      } catch(e) {
        console.error('Error parseando carrito:', e);
        return [];
      }
    }

    function writeCart(cart) {
      localStorage.setItem(CART_KEY, JSON.stringify(cart));
      // emitir evento de storage manual para la misma pestaña
      window.dispatchEvent(new StorageEvent('storage', { key: CART_KEY, newValue: JSON.stringify(cart) }));
    }

    function formatPrice(n) {
      return '$' + Number(n).toLocaleString('es-CO');
    }

    function updateCartCounterUI() {
      const cart = readCart();
      const count = cart.reduce((s,i)=> s + (i.qty||0), 0);
      const el = document.getElementById('cart-counter');
      if (!el) return;
      if (count > 0) {
        el.style.display = 'flex';
        el.textContent = count;
      } else {
        el.style.display = 'none';
      }
    }

    function renderCartItems() {
      const itemsContainer = document.getElementById('cart-items');
      const emptyText = document.getElementById('cart-empty-text');
      const totalItemsEl = document.getElementById('cart-total-items');
      const totalPriceEl = document.getElementById('cart-total-price');
      const summarySubtotal = document.getElementById('summary-subtotal');
      const summaryTotal = document.getElementById('summary-total');

      if (!itemsContainer) return;
      const cart = readCart();

      itemsContainer.innerHTML = '';
      if (cart.length === 0) {
        emptyText.classList.remove('hidden');
      } else {
        emptyText.classList.add('hidden');
      }

      let subtotal = 0;
      let totalItems = 0;

      cart.forEach(item => {
        subtotal += item.price * item.qty;
        totalItems += item.qty;

        const row = document.createElement('div');
        row.className = 'flex items-center gap-4 bg-gray-50 dark:bg-gray-900 rounded-lg p-4';

        row.innerHTML = `
          <img src="${item.image || 'https://via.placeholder.com/120'}" alt="${item.title}" class="w-20 h-20 object-cover rounded-md flex-shrink-0">
          <div class="flex-1">
            <div class="font-semibold text-gray-800 dark:text-gray-100">${item.title}</div>
            <div class="text-sm text-gray-500 dark:text-gray-300">${formatPrice(item.price)}</div>
            <div class="mt-2 flex items-center gap-2">
              <button class="decrease-qty px-2 py-1 border rounded text-gray-700 dark:text-gray-200">-</button>
              <span class="px-3 py-1 bg-white dark:bg-gray-800 rounded">${item.qty}</span>
              <button class="increase-qty px-2 py-1 border rounded text-gray-700 dark:text-gray-200">+</button>
              <button class="remove-item ml-4 text-sm text-rose-600 dark:text-rose-400">Eliminar</button>
            </div>
          </div>
          <div class="text-right">
            <div class="font-semibold text-gray-800 dark:text-gray-100">${formatPrice(item.price * item.qty)}</div>
          </div>
        `;

        // eventos de aumento / disminución / eliminar
        row.querySelector('.increase-qty').addEventListener('click', () => {
          updateQty(item.id, item.qty + 1);
        });
        row.querySelector('.decrease-qty').addEventListener('click', () => {
          updateQty(item.id, Math.max(1, item.qty - 1));
        });
        row.querySelector('.remove-item').addEventListener('click', () => {
          removeItem(item.id);
        });

        itemsContainer.appendChild(row);
      });

      // actualizar resumen
      totalItemsEl.textContent = totalItems;
      totalPriceEl.textContent = formatPrice(subtotal);
      if (summarySubtotal) summarySubtotal.textContent = formatPrice(subtotal);
      if (summaryTotal) summaryTotal.textContent = formatPrice(subtotal);
      updateCartCounterUI();
    }

    function updateQty(id, qty) {
      const cart = readCart();
      const idx = cart.findIndex(i => i.id === id);
      if (idx === -1) return;
      cart[idx].qty = qty;
      writeCart(cart);
      renderCartItems();
      showNotification('Cantidad actualizada', 'info');
    }

    function removeItem(id) {
      let cart = readCart();
      cart = cart.filter(i => i.id !== id);
      writeCart(cart);
      renderCartItems();
      showNotification('Producto eliminado del carrito', 'info');
    }

    function clearCart() {
      writeCart([]);
      renderCartItems();
      showNotification('Carrito vaciado', 'info');
    }

    // Simple toast (reusa container ya en el DOM)
    function showNotification(message, type='info') {
      const container = document.getElementById('toast-container');
      if (!container) return;
      const isDark = document.documentElement.classList.contains('dark');
      const toast = document.createElement('div');
      toast.className = `px-4 py-3 rounded-lg shadow-lg border transition-all duration-300 ${isDark ? 'bg-gray-900 text-white border-gray-700' : 'bg-white text-gray-900 border-gray-200'}`;
      toast.textContent = message;
      container.appendChild(toast);
      requestAnimationFrame(()=> {
        toast.classList.add('opacity-100');
      });
      setTimeout(()=> {
        toast.remove();
      }, 3000);
    }

    // handlers UI
    document.addEventListener('DOMContentLoaded', () => {
      renderCartItems();

      // botones
      document.getElementById('continue-shopping')?.addEventListener('click', () => {
        window.location.href = './productos.html';
      });

      document.getElementById('empty-cart')?.addEventListener('click', () => {
        if (confirm('¿Vaciar el carrito?')) clearCart();
      });

      document.getElementById('checkout-btn')?.addEventListener('click', () => {
        const cart = readCart();
        if (!cart.length) return alert('Tu carrito está vacío.');
        // Aquí puedes integrar checkout; por ahora sólo simulamos
        showNotification('Proceso de pago simulado (implementa tu gateway)', 'info');
      });

      // Escuchar storage para actualizar si cambian en otra pestaña
      window.addEventListener('storage', (e) => {
        if (!e.key || e.key === CART_KEY) {
          renderCartItems();
        }
      });
    });

  </script>

  <script src="../js/main.js" defer></script>
</body>
</html>
